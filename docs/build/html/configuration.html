

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server Configuration &mdash; Plant IT Alpha documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="plantit package" href="plantit.html" />
    <link rel="prev" title="System Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Plant IT
          

          
          </a>

          
            
            
              <div class="version">
                0.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">System Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Server Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment-specific-django-settings">Environment Specific Django Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#development-dev">Development (dev)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#production-prod">Production (prod)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filesystems">Filesystems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-workflows">Installing Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-clusters">Adding Clusters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-plant-it-cluster-side-code">Installing Plant IT Cluster-side Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-cluster-to-plant-it-backend">Adding Cluster to Plant IT backend.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cluster-ssh-login-configuration">Cluster ssh login configuration.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plantit.html">plantit package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apis.html">apis package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Plant IT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Server Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="server-configuration">
<h1>Server Configuration<a class="headerlink" href="#server-configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="environment-specific-django-settings">
<h2>Environment Specific Django Settings<a class="headerlink" href="#environment-specific-django-settings" title="Permalink to this headline">¶</a></h2>
<p>If present, PlantIT loads <cite>django/settings.py</cite> as part of django’s <cite>settings.py</cite>
file. This can be used for any environment specific configuration that should
not be committed to the repository.</p>
<p>Values set in <cite>django/settings.py</cite> override any PlantIT default settings.</p>
</div>
<div class="section" id="docker">
<span id="configuration-docker"></span><h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>Plant IT is packaged within docker containers using
<a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a>. There are two
docker-compose configurations: dev and prod. They share <cite>./docker-compose.yml</cite>
as a common docker-compose configuration file as well as independent
configuration files.</p>
<div class="section" id="development-dev">
<h3>Development (dev)<a class="headerlink" href="#development-dev" title="Permalink to this headline">¶</a></h3>
<p>Configuration file: <cite>./compose-dev.yml</cite></p>
<p>The development configuration runs django in development mode (debug on,
auto restart on file changes, etc.) and includes docker containers for
a test cluster (<cite>ssh</cite> docker-compose service) and test irods server
(<cite>irods</cite> docker-compose service).</p>
<p>The development environment loads <cite>django/plantit/settings_dev.py</cite> as the
root django settings file.</p>
<p>The development environment can be started using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f docker-compose.yml -f compose-dev.yml up
</pre></div>
</div>
</div>
<div class="section" id="production-prod">
<h3>Production (prod)<a class="headerlink" href="#production-prod" title="Permalink to this headline">¶</a></h3>
<p>Configuration file: <cite>./compose-prod.yml</cite></p>
<p>The production configuration runs django in production mode within, utilizing
<a class="reference external" href="https://gunicorn.org/">gunicorn</a> as a WSGI HTTP server
and <a class="reference external" href="https://www.nginx.com/">nginx</a> as the web server.</p>
<p>All logs are configured to be sent to a GELF server via udp at
udp://localhost:12201 (Eg. sent to a <cite>graylog &lt;https://www.graylog.org/&gt;_</cite>
instance).</p>
<p>The production environment loads <cite>django/plantit/settings_prod.py</cite> as the
root django settings file.</p>
<p>The production environment can be started using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f docker-compose.yml -f compose-prod.yml up -d
</pre></div>
</div>
</div>
</div>
<div class="section" id="filesystems">
<span id="configuration-filesystems"></span><h2>Filesystems<a class="headerlink" href="#filesystems" title="Permalink to this headline">¶</a></h2>
<p>Plant IT looks for file-system configurations in <cite>django/filesystems.py</cite>. Since
this file is specific to each Plant IT installation, it is not included in the
git repository. It must be created.</p>
<p>Filesystems that extend
<a class="reference internal" href="plantit.file_manager.filesystems.html#plantit.file_manager.filesystems.storage.AbstractStorageType" title="plantit.file_manager.filesystems.storage.AbstractStorageType"><code class="xref py py-class docutils literal notranslate"><span class="pre">plantit.file_manager.filesystems.storage.AbstractStorageType</span></code></a> can be
registered with Plant IT within the <cite>filesystems.py</cite> folder as follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">django/filesystems.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plantit.file_manager.filesystems</span> <span class="kn">import</span> <span class="n">registrar</span>

<span class="n">registrar</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
  <span class="c1">#file system instance</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Replacing <cite>file system instance</cite> with a instance of a class that extends
<a class="reference internal" href="plantit.file_manager.filesystems.html#plantit.file_manager.filesystems.storage.AbstractStorageType" title="plantit.file_manager.filesystems.storage.AbstractStorageType"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractStorageType</span></code></a>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The web server and celery process will need to be restarted
after adding a new filesystem.</p>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The development environment includes a test irods server in a docker container
to use for testing. To add it as a filesystem, create <cite>django/filesystems.py</cite> and add:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">django/filesystems.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">plantit.file_manager.filesystems.irods</span> <span class="kn">import</span> <span class="n">IRods</span>
<span class="kn">from</span> <span class="nn">plantit.file_manager.filesystems</span> <span class="kn">import</span> <span class="n">registrar</span>

<span class="n">registrar</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">IRods</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;irods&quot;</span><span class="p">,</span>
                         <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;rods&quot;</span><span class="p">,</span>
                         <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;rods&quot;</span><span class="p">,</span>
                         <span class="n">port</span> <span class="o">=</span> <span class="mi">1247</span><span class="p">,</span>
                         <span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;irods&quot;</span><span class="p">,</span>
                         <span class="n">zone</span> <span class="o">=</span> <span class="s2">&quot;tempZone&quot;</span><span class="p">),</span>
                    <span class="k">lambda</span> <span class="n">user</span><span class="p">:</span> <span class="s2">&quot;/tempZone/home/rods/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>the dev systems can then be restarted using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f docker-compose.yml -f compose-dev.yml restart djangoapp
docker-compose -f docker-compose.yml -f compose-dev.yml restart celery
</pre></div>
</div>
</div>
</div>
<div class="section" id="installing-workflows">
<span id="configuration-installing-workflows"></span><h2>Installing Workflows<a class="headerlink" href="#installing-workflows" title="Permalink to this headline">¶</a></h2>
<p>Workflows created using the
<a class="reference external" href="https://github.com/Computational-Plant-Science/cookiecutter_PlantIT">Plant IT workflow template</a>
can be integrated into the web platform by cloning the repository
(or copying the code) into the <cite>django/workflows</cite> directory.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The web server and celery processes must be restarted to load new workflows.
If running the website in production mode, collectstatic will also need
to be rerun after the restart to collect any new workflow icons.</p>
</div>
<p>Once restarted, the Plant IT server will automatically find and register
the new workflow.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some assertions are checked on loading the workflows, if these assertions
fail, the web server will not start. Check the logs for deatails of what
assertion failed.</p>
</div>
<div class="section" id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> django/workflows/
git clone git@github.com:Computational-Plant-Science/DIRT2D_Workflow.git dirt2d <span class="c1">#&lt;- see note below</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The workflow folder name (inside django/workflows/) must be the same as the
workflow app_name set in the workflow’s WORKFLOW_CONFIG.</p>
</div>
</div>
</div>
<div class="section" id="adding-clusters">
<h2>Adding Clusters<a class="headerlink" href="#adding-clusters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-plant-it-cluster-side-code">
<h3>Installing Plant IT Cluster-side Code<a class="headerlink" href="#installing-plant-it-cluster-side-code" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://github.com/Computational-Plant-Science/DIRT2_ClusterSide">ClusterSide README</a>
for information on installation and configuration of required remote Plant IT code on cluster.</p>
</div>
<div class="section" id="adding-cluster-to-plant-it-backend">
<h3>Adding Cluster to Plant IT backend.<a class="headerlink" href="#adding-cluster-to-plant-it-backend" title="Permalink to this headline">¶</a></h3>
<p>Clusters are added via the admin interface (/admin/).
Choose Clusters-&gt;Add Cluster. Fill in the commands accordingly.</p>
<p>Typically, the submit commands will include clusterside submit.
They may also include loading packages necessary to run clusterside,
for example, loading python3.</p>
<p>For Sapelo2 (UGA’s cluster), the submit command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ml Python/3.6.4-foss-2018a<span class="p">;</span> /home/cotter/.local/bin/clusterside submit
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On some types of ssh connections, installation does not put clusterside in the
path. If the cluster throwing a “clusterside not found” error when submitting
jobs. Try using the whole path of clusterside for submitting.
This can be found by logging in to the cluster as the user PlantIT uses
to submit the jobs and executing <cite>which clusterside</cite></p>
</div>
<div class="section" id="cluster-ssh-login-configuration">
<span id="configuration-clusters-ssh-config"></span><h4>Cluster ssh login configuration.<a class="headerlink" href="#cluster-ssh-login-configuration" title="Permalink to this headline">¶</a></h4>
<p>Plant IT supports both ssh password and public-key based login.
To use public-key login, leave the Password field blank.
Public-key login requires the private key and a known_hosts list to be
available. Plant IT expects this data to be in the following two files:</p>
<ul class="simple">
<li><p><cite>config/ssh/id_rsa</cite>: The private key used for login</p></li>
<li><p><cite>config/ssh/known_hosts</cite>: The known_hosts file.</p></li>
</ul>
<p>The easiest way to setup public-key logins is to configure the keys for
login from the web server, then copy the configured id_rsa and known_hosts
files from the web server user (typically in <cite>$HOME/.ssh/</cite>) to <cite>config/ssh/</cite></p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plantit.html" class="btn btn-neutral float-right" title="plantit package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="System Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, CPS Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>